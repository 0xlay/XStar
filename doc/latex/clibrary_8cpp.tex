\hypertarget{clibrary_8cpp}{}\doxysection{kernel\+\_\+space/runtime/clibrary.cpp File Reference}
\label{clibrary_8cpp}\index{kernel\_space/runtime/clibrary.cpp@{kernel\_space/runtime/clibrary.cpp}}
{\ttfamily \#include \char`\"{}clibrary.\+hpp\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$\+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_ae3fcaa4688d6a02f882956948a49f515}{malloc}} (size\+\_\+t size) noexcept
\item 
void \+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_a473ea057c744e96b74129c5d82cd8b44}{free}} (void $\ast$ptr) noexcept
\item 
void $\ast$\+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_ac26e8123f294092bbddd24de3ff7e6c3}{calloc}} (size\+\_\+t num, size\+\_\+t size) noexcept
\item 
void $\ast$\+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_a6bdd02e3203ce194c0a1339f4c3d9a30}{realloc}} (void $\ast$ptr, size\+\_\+t new\+\_\+size) noexcept
\item 
void $\ast$ \mbox{\hyperlink{clibrary_8cpp_a394384251630f81671be91e46ff0fc14}{vmalloc}} (size\+\_\+t size) noexcept
\item 
void \+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_a36c2c0f0f47a5845d284f8f131f70afe}{vfree}} (void $\ast$ptr) noexcept
\item 
void $\ast$\+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_aa5207f879302e3c3542f09cbc9af5bc7}{vcalloc}} (size\+\_\+t num, size\+\_\+t size) noexcept
\item 
void $\ast$\+\_\+\+\_\+cdecl \mbox{\hyperlink{clibrary_8cpp_a67bdf7d4b935381b919ca1842cc11ca7}{vrealloc}} (void $\ast$ptr, size\+\_\+t new\+\_\+size) noexcept
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{clibrary_8cpp_ac26e8123f294092bbddd24de3ff7e6c3}\label{clibrary_8cpp_ac26e8123f294092bbddd24de3ff7e6c3}} 
\index{clibrary.cpp@{clibrary.cpp}!calloc@{calloc}}
\index{calloc@{calloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{calloc()}{calloc()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+cdecl calloc (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{num,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 74 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{75 \{}
\DoxyCodeLine{76     \textcolor{keywordtype}{size\_t} size\_ = num * size;}
\DoxyCodeLine{77     ASSERT(size\_ != 0);}
\DoxyCodeLine{78 }
\DoxyCodeLine{79     \textcolor{keywordtype}{void}* ptr = \mbox{\hyperlink{clibrary_8cpp_ae3fcaa4688d6a02f882956948a49f515}{malloc}}(size\_);}
\DoxyCodeLine{80     \textcolor{keywordflow}{if} (!ptr)}
\DoxyCodeLine{81         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{82     }
\DoxyCodeLine{83     \textcolor{keywordflow}{return} RtlZeroMemory(ptr, size\_);}
\DoxyCodeLine{84 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_a473ea057c744e96b74129c5d82cd8b44}\label{clibrary_8cpp_a473ea057c744e96b74129c5d82cd8b44}} 
\index{clibrary.cpp@{clibrary.cpp}!free@{free}}
\index{free@{free}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{free()}{free()}}
{\footnotesize\ttfamily void \+\_\+\+\_\+cdecl free (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 61 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{62 \{}
\DoxyCodeLine{63     \textcolor{keywordflow}{if} (ptr)}
\DoxyCodeLine{64     \{}
\DoxyCodeLine{65         ExFreePoolWithTag(}
\DoxyCodeLine{66             \mbox{\hyperlink{clibrary_8hpp_a0a4b1dd0c173e8647383f0f1424a456a}{getBasePointer}}(ptr), \textcolor{comment}{/* returns the base address of an instance of a structure */}}
\DoxyCodeLine{67             \mbox{\hyperlink{clibrary_8hpp_a69b2d8c66523796f6168beea839fa3f2}{\_C\_LIBRARY\_TAG\_}}}
\DoxyCodeLine{68         );}
\DoxyCodeLine{69         ptr = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{70     \}}
\DoxyCodeLine{71 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_ae3fcaa4688d6a02f882956948a49f515}\label{clibrary_8cpp_ae3fcaa4688d6a02f882956948a49f515}} 
\index{clibrary.cpp@{clibrary.cpp}!malloc@{malloc}}
\index{malloc@{malloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{malloc()}{malloc()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+cdecl malloc (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 30 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{31 \{}
\DoxyCodeLine{32     ASSERT(size != 0);}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{preprocessor}{    \#if (NTDDI\_VERSION >= NTDDI\_WIN10\_VB) }\textcolor{comment}{// minimum Windows 10 2004}}
\DoxyCodeLine{35     \mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}} memoryBlock = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(}
\DoxyCodeLine{36         ExAllocatePool2(}
\DoxyCodeLine{37             POOL\_FLAG\_NON\_PAGED | POOL\_FLAG\_CACHE\_ALIGNED,}
\DoxyCodeLine{38             size + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{MEMBLOCK}}),}
\DoxyCodeLine{39             \mbox{\hyperlink{clibrary_8hpp_a69b2d8c66523796f6168beea839fa3f2}{\_C\_LIBRARY\_TAG\_}}}
\DoxyCodeLine{40         )}
\DoxyCodeLine{41     );}
\DoxyCodeLine{42 \textcolor{preprocessor}{    \#else }\textcolor{comment}{// deprecated in Windows 10 2004}}
\DoxyCodeLine{43     \mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}} memoryBlock = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(}
\DoxyCodeLine{44         ExAllocatePoolWithTag(}
\DoxyCodeLine{45             NonPagedPoolNxCacheAligned, \textcolor{comment}{// alignment}}
\DoxyCodeLine{46             size + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{MEMBLOCK}}),}
\DoxyCodeLine{47             \mbox{\hyperlink{clibrary_8hpp_a69b2d8c66523796f6168beea839fa3f2}{\_C\_LIBRARY\_TAG\_}}}
\DoxyCodeLine{48         )}
\DoxyCodeLine{49     );}
\DoxyCodeLine{50 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \textcolor{keywordflow}{if} (!memoryBlock)}
\DoxyCodeLine{53         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a7022b77025ce284a7a1e46390274654e}{size}} = size;}
\DoxyCodeLine{56     memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a2236e91a4b92364a9568d25d69ec40f6}{data}} = \mbox{\hyperlink{clibrary_8hpp_abea415c8f6dfb8cbc2478170de165a8f}{getDataPointer}}(memoryBlock);}
\DoxyCodeLine{57     \textcolor{keywordflow}{return} memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a2236e91a4b92364a9568d25d69ec40f6}{data}};}
\DoxyCodeLine{58 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_a6bdd02e3203ce194c0a1339f4c3d9a30}\label{clibrary_8cpp_a6bdd02e3203ce194c0a1339f4c3d9a30}} 
\index{clibrary.cpp@{clibrary.cpp}!realloc@{realloc}}
\index{realloc@{realloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{realloc()}{realloc()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+cdecl realloc (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr,  }\item[{size\+\_\+t}]{new\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 87 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{88 \{}
\DoxyCodeLine{89     \textcolor{keywordtype}{size\_t} current\_size = \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(\mbox{\hyperlink{clibrary_8hpp_a0a4b1dd0c173e8647383f0f1424a456a}{getBasePointer}}(ptr))-\/>size;}
\DoxyCodeLine{90     \textcolor{keywordflow}{if} (current\_size <= new\_size)}
\DoxyCodeLine{91         \textcolor{keywordflow}{return} ptr;}
\DoxyCodeLine{92 }
\DoxyCodeLine{93     \mbox{\hyperlink{clibrary_8cpp_a473ea057c744e96b74129c5d82cd8b44}{free}}(ptr);}
\DoxyCodeLine{94     ptr = \mbox{\hyperlink{clibrary_8cpp_ae3fcaa4688d6a02f882956948a49f515}{malloc}}(new\_size);}
\DoxyCodeLine{95     \textcolor{keywordflow}{return} ptr;}
\DoxyCodeLine{96 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_aa5207f879302e3c3542f09cbc9af5bc7}\label{clibrary_8cpp_aa5207f879302e3c3542f09cbc9af5bc7}} 
\index{clibrary.cpp@{clibrary.cpp}!vcalloc@{vcalloc}}
\index{vcalloc@{vcalloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{vcalloc()}{vcalloc()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+cdecl vcalloc (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{num,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 144 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{145 \{}
\DoxyCodeLine{146     PAGED\_CODE();}
\DoxyCodeLine{147     \textcolor{keywordtype}{size\_t} size\_ = num * size;}
\DoxyCodeLine{148     ASSERT(size\_ != 0);}
\DoxyCodeLine{149 }
\DoxyCodeLine{150     \textcolor{keywordtype}{void}* ptr = \mbox{\hyperlink{clibrary_8cpp_a394384251630f81671be91e46ff0fc14}{vmalloc}}(size\_);}
\DoxyCodeLine{151     \textcolor{keywordflow}{if} (!ptr)}
\DoxyCodeLine{152         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{153 }
\DoxyCodeLine{154     \textcolor{keywordflow}{return} RtlZeroMemory(ptr, size\_);}
\DoxyCodeLine{155 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_a36c2c0f0f47a5845d284f8f131f70afe}\label{clibrary_8cpp_a36c2c0f0f47a5845d284f8f131f70afe}} 
\index{clibrary.cpp@{clibrary.cpp}!vfree@{vfree}}
\index{vfree@{vfree}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{vfree()}{vfree()}}
{\footnotesize\ttfamily void \+\_\+\+\_\+cdecl vfree (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 137 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{138 \{}
\DoxyCodeLine{139     PAGED\_CODE();}
\DoxyCodeLine{140     \mbox{\hyperlink{clibrary_8cpp_a473ea057c744e96b74129c5d82cd8b44}{free}}(ptr);}
\DoxyCodeLine{141 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_a394384251630f81671be91e46ff0fc14}\label{clibrary_8cpp_a394384251630f81671be91e46ff0fc14}} 
\index{clibrary.cpp@{clibrary.cpp}!vmalloc@{vmalloc}}
\index{vmalloc@{vmalloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{vmalloc()}{vmalloc()}}
{\footnotesize\ttfamily void$\ast$ vmalloc (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 106 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{107 \{}
\DoxyCodeLine{108     PAGED\_CODE();}
\DoxyCodeLine{109     ASSERT(size != 0);}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{preprocessor}{    \#if (NTDDI\_VERSION >= NTDDI\_WIN10\_VB) }\textcolor{comment}{// minimum Windows 10 2004}}
\DoxyCodeLine{112     \mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}} memoryBlock = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(}
\DoxyCodeLine{113         ExAllocatePool2(}
\DoxyCodeLine{114             POOL\_FLAG\_PAGED | POOL\_FLAG\_CACHE\_ALIGNED,}
\DoxyCodeLine{115             size + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{MEMBLOCK}}),}
\DoxyCodeLine{116             \mbox{\hyperlink{clibrary_8hpp_a69b2d8c66523796f6168beea839fa3f2}{\_C\_LIBRARY\_TAG\_}}}
\DoxyCodeLine{117         )}
\DoxyCodeLine{118     );}
\DoxyCodeLine{119 \textcolor{preprocessor}{    \#else }\textcolor{comment}{// deprecated in Windows 10 2004}}
\DoxyCodeLine{120     \mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}} memoryBlock = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(}
\DoxyCodeLine{121         ExAllocatePoolWithTag(}
\DoxyCodeLine{122             PagedPoolCacheAligned, \textcolor{comment}{// alignment}}
\DoxyCodeLine{123             size + \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{MEMBLOCK}}),}
\DoxyCodeLine{124             \mbox{\hyperlink{clibrary_8hpp_a69b2d8c66523796f6168beea839fa3f2}{\_C\_LIBRARY\_TAG\_}}}
\DoxyCodeLine{125         )}
\DoxyCodeLine{126     );}
\DoxyCodeLine{127 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{128     \textcolor{keywordflow}{if} (!memoryBlock)}
\DoxyCodeLine{129         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{130     }
\DoxyCodeLine{131     memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a7022b77025ce284a7a1e46390274654e}{size}} = size;}
\DoxyCodeLine{132     memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a2236e91a4b92364a9568d25d69ec40f6}{data}} = \mbox{\hyperlink{clibrary_8hpp_abea415c8f6dfb8cbc2478170de165a8f}{getDataPointer}}(memoryBlock);}
\DoxyCodeLine{133     \textcolor{keywordflow}{return} memoryBlock-\/>\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k_a2236e91a4b92364a9568d25d69ec40f6}{data}};}
\DoxyCodeLine{134 \}}

\end{DoxyCode}
\mbox{\Hypertarget{clibrary_8cpp_a67bdf7d4b935381b919ca1842cc11ca7}\label{clibrary_8cpp_a67bdf7d4b935381b919ca1842cc11ca7}} 
\index{clibrary.cpp@{clibrary.cpp}!vrealloc@{vrealloc}}
\index{vrealloc@{vrealloc}!clibrary.cpp@{clibrary.cpp}}
\doxysubsubsection{\texorpdfstring{vrealloc()}{vrealloc()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+cdecl vrealloc (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr,  }\item[{size\+\_\+t}]{new\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Definition at line 158 of file clibrary.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{159 \{}
\DoxyCodeLine{160     PAGED\_CODE();}
\DoxyCodeLine{161     \textcolor{keywordtype}{size\_t} current\_size = \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{struct___m_e_m_b_l_o_c_k}{PMEMBLOCK}}\textcolor{keyword}{>}(\mbox{\hyperlink{clibrary_8hpp_a0a4b1dd0c173e8647383f0f1424a456a}{getBasePointer}}(ptr))-\/>size;}
\DoxyCodeLine{162     \textcolor{keywordflow}{if} (current\_size <= new\_size)}
\DoxyCodeLine{163         \textcolor{keywordflow}{return} ptr;}
\DoxyCodeLine{164 }
\DoxyCodeLine{165     \mbox{\hyperlink{clibrary_8cpp_a36c2c0f0f47a5845d284f8f131f70afe}{vfree}}(ptr);}
\DoxyCodeLine{166     ptr = \mbox{\hyperlink{clibrary_8cpp_a394384251630f81671be91e46ff0fc14}{vmalloc}}(new\_size);}
\DoxyCodeLine{167     \textcolor{keywordflow}{return} ptr;}
\DoxyCodeLine{168 \}}

\end{DoxyCode}
